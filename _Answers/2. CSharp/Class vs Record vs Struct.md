 ### Когда использовать **class**, **record** и **struct** в C#

В C# каждый из этих типов данных предназначен для решения разных задач. Рассмотрим их особенности, отличия и сценарии применения.

---

### **1. Class**
**Class** (класс) — это ссылочный тип. Объекты классов создаются в управляемой куче (heap), и переменные, ссылающиеся на них, содержат ссылки на данные.

#### Особенности:
- **Ссылочный тип**: Переменные указывают на один и тот же объект в памяти.
- **Сборка мусора**: Управляется сборщиком мусора (GC).
- **Поддерживает наследование**: Полноценная объектно-ориентированная модель.
- **Может быть null**.
- **Mutable** (изменяемый) по умолчанию.

#### Пример:
```csharp
public class Person
{
    public string Name { get; set; }
    public int Age { get; set; }
}
```

#### Когда использовать:
1. Для объектов с длительным временем жизни (например, сервисы).
2. Когда необходима поддержка полиморфизма или наследования.
3. Для больших объектов, где копирование данных нежелательно.
4. Если объект должен быть изменяемым.

---

### **2. Record**
**Record** (запись) — это ссылочный тип, введённый в C# 9, специально для создания **неизменяемых объектов** (immutable objects). Основное предназначение — представление данных с акцентом на их содержимое, а не идентичность.

#### Особенности:
- **Ссылочный тип**, как и класс.
- **Value-based equality**: Сравнение по содержимому, а не по ссылке.
- Автоматически создаются методы `Equals`, `GetHashCode` и `ToString`.
- **Immutable**: Свойства неизменяемы по умолчанию (можно изменить).
- Поддерживает наследование.

#### Пример:
```csharp
public record Person(string Name, int Age);
```

> Это короткий синтаксис с использованием **Primary Constructor**.

#### Расширение с изменяемыми свойствами:
```csharp
public record Person
{
    public string Name { get; init; }
    public int Age { get; init; }
}
```

#### Когда использовать:
1. Для представления данных (DTO, конфигурации, запросы/ответы API).
2. Если объект неизменяем и важны его содержимое и структура.
3. Для функционального подхода, где неизменяемость предпочтительна.

---

### **3. Struct**
**Struct** (структура) — это **значимый тип**. Создаётся в стеке (stack) и копируется при передаче, что делает его полезным для небольших объектов.

#### Особенности:
- **Значимый тип**: Данные хранятся непосредственно в переменной.
- **Быстрее в копировании**, особенно для небольших объектов.
- **Не поддерживает наследование** (кроме интерфейсов).
- Не может быть null (если не использовать `Nullable<T>` или `?`).
- Рекомендуется для небольших объектов с фиксированным размером.

#### Пример:
```csharp
public struct Point
{
    public int X { get; set; }
    public int Y { get; set; }
}
```

#### Когда использовать:
1. Для небольших, часто копируемых объектов (например, `Point`, `Vector`).
2. Если объект неизменяем и не требует большого количества памяти.
3. Для повышения производительности при большом числе экземпляров.
4. Для данных, которые логически являются единым целым (например, координаты, цвет).

---

### Сравнение: **class** vs **record** vs **struct**

| **Функция**            | **Class**                       | **Record**                     | **Struct**                     |
|-------------------------|----------------------------------|---------------------------------|--------------------------------|
| Тип                    | Ссылочный                      | Ссылочный                     | Значимый                      |
| Хранение               | Heap                           | Heap                          | Stack (или heap в массивах)   |
| Изменяемость           | Изменяемый                     | Неизменяемый по умолчанию     | Обычно неизменяемый           |
| Сравнение              | По ссылке                      | По значению                   | По значению                   |
| Производительность      | Выше для больших объектов       | Аналогична классу             | Быстрее для мелких объектов   |
| Наследование           | Поддерживается                 | Поддерживается                | Не поддерживается             |
| Использование в API    | DTO, сервисы                   | DTO, неизменяемые данные      | Мелкие типы, параметры функций|

---

### Примеры применения

#### **Class**
- Сервис или менеджер:
  ```csharp
  public class UserManager
  {
      public void AddUser(string name) { /* ... */ }
  }
  ```

#### **Record**
- DTO для передачи данных:
  ```csharp
  public record UserDto(string Name, int Age);
  ```

#### **Struct**
- Точка на плоскости:
  ```csharp
  public struct Point
  {
      public int X { get; }
      public int Y { get; }

      public Point(int x, int y)
      {
          X = x;
          Y = y;
      }
  }
  ```

---

### Выводы

- Используйте **class**, если:
  - Требуется изменяемость.
  - Нужна поддержка наследования.
  - Объект большой или работает как часть сложного процесса (например, сервис).

- Используйте **record**, если:
  - Объект неизменяем.
  - Важны сравнения по значению.
  - Это объект данных (например, результат API).

- Используйте **struct**, если:
  - Объект маленький и часто копируется.
  - Важна производительность.
  - Объект неизменяем и логически представляет атомарные данные.

Каждый из типов нацелен на конкретные задачи, и выбор зависит от требований к производительности, неизменяемости и модели данных.