`string` в .NET — это **неизменяемый** (immutable) ссылочный тип, представляющий последовательность символов UTF‑16. Его особенности и уникальные свойства отличают его от остальных типов и влияют на подходы к работе с текстом.

## Особенности `string`

- **Иммутабельность**  
  После создания содержимое строки нельзя изменить. Все операции, которые кажутся «изменяющими» строку, на самом деле создают **новый** объект `string`.

- **Пул строк (String Interning)**  
  CLR поддерживает глобальный пул литералов строк. Две одинаковые строковые литералы в коде ссылаются на один объект:

```csharp
  string a = "hello";
  string b = "hello";
  Console.WriteLine(ReferenceEquals(a, b)); // True
```

Можно вручную интернировать строку через `string.Intern()` и `string.IsInterned()`.


- **Структура в памяти**  
    Строка хранит в себе:
    
    1. Объектную шапку (MethodTable pointer, SyncBlock).
        
    2. Поле `_length` (int) — длина.
        
    3. Массив `char[]` непосредственно после `_length` (UTF‑16 code units).
        
    4. Заключительный `\0` для совместимости с нативным кодом.
        
- **Потокобезопасность для чтения**  
    Иммутабельные объекты безопасно читаться из нескольких потоков без блокировок.
    
- **Операции**
    
    - Конкатенация (`+`, `String.Concat`)
        
    - Подстроки (`Substring`)
        
    - Поиск (`IndexOf`, `StartsWith`, `Contains`)
        
    - Форматирование (`String.Format`, интерполяция `$"{...}"`)  
        Каждая из этих операций при необходимости выделяет новый `string` в куче (SOH или LOH для длинных строк).
        
- **Производительность**  
    Многочисленные конкатенации в цикле приводят к **многочисленным аллокациям** и давлению на GC.
    
    ```csharp
    string s = "";
    for (int i = 0; i < 1000; i++)
        s += i; // каждый раз новый объект
    ```
    

## `StringBuilder`

`StringBuilder` — класс из `System.Text` для **эффективного** построения и модификации текста. Он использует **внутренний изменяемый** буфер `char[]`, который растёт по мере необходимости, избегая лишних аллокаций.

```csharp
var sb = new StringBuilder(capacity: 256);
sb.Append("Hello");
sb.Append(' ');
sb.AppendLine("world!");
sb.Replace("world", "CLR");
string result = sb.ToString();
```

- **Capacity и автоматический рост**
    
    - При создании выделяется `char[]` заданной ёмкости.
        
    - При переполнении создаётся новый буфер вместимостью примерно вдвое больше, копируя содержимое.
        
- **Основные методы**
    
    - `Append`, `AppendLine`, `AppendFormat`
        
    - `Insert`, `Remove`, `Replace`
        
    - `ToString()` — конвертирует текущий буфер в неизменяемый `string`.
        
- **Производительность**
    
    - При построении больших или составных строк `StringBuilder` даёт **линейную** сложность вместо квадратичной при конкатенации.
        
    - Избегает частых GC‑аллокаций, так как буфер расширяется экспоненциально.
        
- **Умеренный оверхед**  
    Для очень коротких строк или небольшого числа операций может быть даже медленнее простых конкатенаций из‑за дополнительной логики.
    

## Отличия от других типов

- **В отличие от value‑types (`struct`)**  
    `string` — ссылочный, живёт в управляемой куче и управляется GC, тогда как `struct` размещается на стеке или внутри других объектов.
    
- **В отличие от обычных ссылочных типов (`class`)**  
    `string` — иммутабельный и поддерживает интернирование, тогда как большинство классов изменяемы и не пулятся.
    
- **В отличие от `char[]`**  
    `char[]` — изменяемый массив символов, но не предоставляет удобных операций над текстом и не участвует в пуле строк. Каждая манипуляция с массивом вручную остаётся за разработчиком.
    
- **В отличие от `StringBuilder`**  
    `StringBuilder` — изменяемый, но **нельзя** напрямую использовать его как `string`; нужно в конце вызвать `ToString()`. У него есть внутренний оверхед и нет интернирования.
    

---

Выбор между `string` и `StringBuilder` зависит от сценария:

- Для **кратких**, **фиксированных** строковых значений — `string`.
    
- Для **частых**, **составных** операций над текстом (конкатенация в цикле, динамическое построение) — `StringBuilder`.
    

```csharp
// Пример: построение CSV
var csv = new StringBuilder();
foreach (var item in items)
{
    csv.Append(item.Id).Append(',')
       .Append(item.Name).Append(',')
       .AppendLine(item.Value.ToString());
}
string output = csv.ToString();
```